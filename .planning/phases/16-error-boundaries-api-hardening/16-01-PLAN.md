---
phase: 16-error-boundaries-api-hardening
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/error.tsx
  - src/app/global-error.tsx
  - src/app/not-found.tsx
  - src/app/loading.tsx
  - src/app/albums/[id]/error.tsx
  - src/app/albums/[id]/loading.tsx
  - src/app/admin/(protected)/error.tsx
  - src/app/admin/(protected)/loading.tsx
autonomous: true

must_haves:
  truths:
    - "When any public page throws an unhandled error, a styled error page appears with a retry button instead of a white screen"
    - "When the root layout itself throws, a self-contained error page with its own html/body tags appears"
    - "When an album detail page throws, a contextual 'Failed to load album' error appears with retry"
    - "When an admin page throws, a styled error page appears without exposing stack traces"
    - "When a user navigates to a nonexistent URL, a styled 404 page appears with navigation back to the gallery"
    - "When navigating between route segments, a loading indicator appears instead of a blank flash"
  artifacts:
    - path: "src/app/error.tsx"
      provides: "Root error boundary for public pages"
      contains: "use client"
    - path: "src/app/global-error.tsx"
      provides: "Root layout error fallback with own html/body"
      contains: "<html>"
    - path: "src/app/not-found.tsx"
      provides: "Styled 404 page with navigation"
      contains: "href"
    - path: "src/app/loading.tsx"
      provides: "Root loading state"
      contains: "animate-pulse"
    - path: "src/app/albums/[id]/error.tsx"
      provides: "Album detail error boundary"
      contains: "use client"
    - path: "src/app/albums/[id]/loading.tsx"
      provides: "Album detail loading skeleton"
      contains: "animate-pulse"
    - path: "src/app/admin/(protected)/error.tsx"
      provides: "Admin error boundary"
      contains: "use client"
    - path: "src/app/admin/(protected)/loading.tsx"
      provides: "Admin loading state"
      contains: "animate-pulse"
  key_links:
    - from: "src/app/error.tsx"
      to: "reset() prop"
      via: "onClick handler on retry button"
      pattern: "reset\\(\\)"
    - from: "src/app/global-error.tsx"
      to: "reset() prop"
      via: "onClick handler with own html/body wrapper"
      pattern: "<html>"
    - from: "src/app/not-found.tsx"
      to: "/"
      via: "Link component navigation"
      pattern: "href.*/"
---

<objective>
Create all error boundary, not-found, and loading files across the app's route segments.

Purpose: Users never see a white screen crash, a raw framework 404, or a blank flash during navigation. Every failure surface has a designed, styled recovery path.
Output: 8 new files implementing ERR-01 through ERR-06.
</objective>

<execution_context>
@/Users/arxherre/.claude/get-shit-done/workflows/execute-plan.md
@/Users/arxherre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-error-boundaries-api-hardening/16-RESEARCH.md
@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root error boundaries and 404 page</name>
  <files>
    src/app/error.tsx
    src/app/global-error.tsx
    src/app/not-found.tsx
  </files>
  <action>
Create three files at the root of src/app/:

**src/app/error.tsx** (ERR-01) -- Client Component:

- Add `"use client"` directive as first line
- Accept `{ error, reset }` props with types `{ error: Error & { digest?: string }; reset: () => void }`
- useEffect to `console.error("Unhandled error:", error)` on error change
- Render centered layout: `min-h-[60vh] flex flex-col items-center justify-center px-4`
- Heading: "Something went wrong" using `text-xl font-semibold text-text-primary`
- Subtitle: "An unexpected error occurred. Please try again." using `text-text-secondary mb-6`
- Two buttons in a `flex gap-3`:
  - "Try again" button: `onClick={() => reset()}`, styled `rounded-lg bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-hover`
  - "Go home" Link to "/": styled `rounded-lg border border-border px-4 py-2 text-sm font-medium text-text-primary hover:bg-surface-hover`

**src/app/global-error.tsx** (ERR-02) -- Client Component:

- Add `"use client"` directive as first line
- Accept same `{ error, reset }` props
- useEffect to `console.error("Global error:", error)` on error change
- MUST include its own `<html lang="en">` and `<body className="bg-background text-foreground font-sans antialiased">` tags (replaces root layout)
- Same centered layout and buttons as error.tsx but self-contained with html/body
- Include inline style tag or use basic Tailwind classes that work without the layout CSS (since globals.css may not load). Use inline styles for background/text colors as fallback: `style={{ backgroundColor: '#1e1e1e', color: '#ededed' }}` on body with a media query comment noting this is a fallback. Actually, simpler: just use the CSS custom properties since globals.css is loaded via layout.tsx import but global-error replaces layout. Use hardcoded colors as safe defaults: body gets `style={{ backgroundColor: '#ffffff', color: '#171717' }}` and a `<style>` tag with `@media (prefers-color-scheme: dark) { body { background: #1e1e1e; color: #ededed; } }` inside the html head area. Keep it minimal -- just enough to not look broken.

**src/app/not-found.tsx** (ERR-05) -- Server Component (no "use client"):

- Import Link from "next/link"
- Render centered layout: `min-h-[60vh] flex flex-col items-center justify-center px-4`
- Large "404" text: `text-6xl font-bold text-text-tertiary mb-2`
- Heading: "Page not found" using `text-xl font-semibold text-text-primary`
- Subtitle: "The page you're looking for doesn't exist." using `text-text-secondary mb-6`
- Link to "/": "Back to gallery" styled same as the "Go home" button in error.tsx but using accent style: `rounded-lg bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-hover`
  </action>
  <verify>
  Run `npm run typecheck` -- no TypeScript errors.
  Run `npm run lint` -- no ESLint errors.
  Verify files exist: `ls src/app/error.tsx src/app/global-error.tsx src/app/not-found.tsx`
  </verify>
  <done>
  Root error.tsx catches rendering errors with retry + home navigation. Global-error.tsx catches root layout errors with self-contained html/body. Not-found.tsx shows styled 404 with link back to gallery. All use project design tokens. No stack traces exposed to users.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create segment-level error boundaries and loading states</name>
  <files>
    src/app/loading.tsx
    src/app/albums/[id]/error.tsx
    src/app/albums/[id]/loading.tsx
    src/app/admin/(protected)/error.tsx
    src/app/admin/(protected)/loading.tsx
  </files>
  <action>
Create 5 files at strategic route segments:

**src/app/loading.tsx** (ERR-06) -- Server Component:

- Render a skeleton that matches the homepage photo grid layout
- Container: `mx-auto max-w-7xl p-4`
- Grid: `grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4`
- 8 placeholder boxes: `aspect-[3/4] rounded-lg bg-surface-secondary animate-pulse`

**src/app/albums/[id]/error.tsx** (ERR-03) -- Client Component:

- Add `"use client"` directive
- Accept `{ error, reset }` props (same types as root error.tsx)
- useEffect to `console.error("Album error:", error)` on error change
- Centered layout same structure as root error.tsx
- Heading: "Failed to load album" (per ERR-03 requirement)
- Subtitle: "There was a problem loading this album. Please try again."
- Same two-button pattern: "Try again" (reset) + "Browse albums" (Link to "/albums")

**src/app/albums/[id]/loading.tsx** (ERR-06) -- Server Component:

- Skeleton matching album detail view
- Container: `mx-auto max-w-7xl p-4`
- Title placeholder: `h-8 w-48 rounded bg-surface-secondary animate-pulse mb-6`
- Photo grid: `grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4`
- 6 placeholder boxes: `aspect-[3/4] rounded-lg bg-surface-secondary animate-pulse`

**src/app/admin/(protected)/error.tsx** (ERR-04) -- Client Component:

- Add `"use client"` directive
- Accept `{ error, reset }` props
- useEffect to `console.error("Admin error:", error)` -- log full error server-side but DO NOT expose error.message in the UI (per ERR-04: no stack traces)
- Centered layout
- Heading: "Something went wrong"
- Subtitle: "An error occurred in the admin panel. Please try again."
- Two buttons: "Try again" (reset) + "Dashboard" (Link to "/admin")

**src/app/admin/(protected)/loading.tsx** (ERR-06) -- Server Component:

- Simple centered spinner for admin (admin UI is utilitarian)
- Container: `flex min-h-[50vh] items-center justify-center`
- Spinner: a `div` with `h-8 w-8 animate-spin rounded-full border-2 border-surface-secondary border-t-accent`
  </action>
  <verify>
  Run `npm run typecheck` -- no TypeScript errors.
  Run `npm run lint` -- no ESLint errors.
  Verify all files exist: `ls src/app/loading.tsx src/app/albums/\[id\]/error.tsx src/app/albums/\[id\]/loading.tsx src/app/admin/\(protected\)/error.tsx src/app/admin/\(protected\)/loading.tsx`
  Run `npm run build` -- successful build with all new files recognized.
  </verify>
  <done>
  Album detail has contextual "Failed to load album" error boundary with retry. Admin has error boundary without stack trace exposure. Root, album detail, and admin segments all have loading states (skeleton grids for gallery, spinner for admin). Navigation between any route segment shows loading indicator instead of blank flash.
  </done>
  </task>

</tasks>

<verification>
- `npm run typecheck` passes
- `npm run lint` passes
- `npm run build` succeeds
- All 8 files exist at correct paths
- error.tsx and global-error.tsx files have "use client" directive
- global-error.tsx contains its own html and body tags
- not-found.tsx is a Server Component (no "use client")
- loading.tsx files use animate-pulse skeleton or spinner patterns
- No error.message or stack traces exposed in any error UI
</verification>

<success_criteria>

- 8 new files created covering ERR-01 through ERR-06
- All error boundaries have retry buttons calling reset()
- Not-found page has navigation back to gallery
- Loading states prevent blank flash during navigation
- No raw error details exposed to end users
- Build succeeds with all new files
  </success_criteria>

<output>
After completion, create `.planning/phases/16-error-boundaries-api-hardening/16-01-SUMMARY.md`
</output>

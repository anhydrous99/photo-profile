---
phase: 06-album-management
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - package.json
  - src/app/admin/(protected)/albums/page.tsx
  - src/app/admin/(protected)/albums/AlbumsPageClient.tsx
  - src/presentation/components/SortableAlbumCard.tsx
  - src/presentation/components/AlbumCreateModal.tsx
  - src/presentation/components/DeleteAlbumModal.tsx
  - src/presentation/components/TagsInput.tsx
  - src/presentation/components/index.ts
autonomous: true

must_haves:
  truths:
    - "Admin can view list of albums at /admin/albums"
    - "Admin can create new album with title, description, and tags"
    - "Admin can drag albums to reorder them"
    - "Admin can delete album with choice of album-only or album+photos"
    - "Album list shows photo count per album"
  artifacts:
    - path: "src/app/admin/(protected)/albums/page.tsx"
      provides: "Albums page server component"
      min_lines: 20
    - path: "src/app/admin/(protected)/albums/AlbumsPageClient.tsx"
      provides: "Albums page client component with drag-drop"
      contains: "DndContext"
    - path: "src/presentation/components/SortableAlbumCard.tsx"
      provides: "Draggable album card"
      contains: "useSortable"
    - path: "src/presentation/components/DeleteAlbumModal.tsx"
      provides: "Delete confirmation with mode selection"
      contains: "deletePhotos"
  key_links:
    - from: "src/app/admin/(protected)/albums/AlbumsPageClient.tsx"
      to: "/api/admin/albums/reorder"
      via: "fetch on drag end"
      pattern: "api/admin/albums/reorder"
    - from: "src/presentation/components/DeleteAlbumModal.tsx"
      to: "/api/admin/albums/[id]"
      via: "fetch DELETE"
      pattern: "DELETE.*api/admin/albums"
---

<objective>
Album management UI: sortable list with drag-drop reordering, create/edit modals, and delete confirmation.

Purpose: Provide admin interface for creating, organizing, and deleting albums with intuitive drag-drop reordering.

Output: Fully functional albums page at /admin/albums with CRUD operations and drag-drop ordering.
</objective>

<execution_context>
@/Users/arxherre/.claude/get-shit-done/workflows/execute-plan.md
@/Users/arxherre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-album-management/06-CONTEXT.md
@.planning/phases/06-album-management/06-RESEARCH.md
@.planning/phases/06-album-management/06-01-SUMMARY.md
@src/app/admin/(protected)/AdminDashboardClient.tsx
@src/presentation/components/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit and create reusable components</name>
  <files>
    package.json
    src/presentation/components/SortableAlbumCard.tsx
    src/presentation/components/AlbumCreateModal.tsx
    src/presentation/components/DeleteAlbumModal.tsx
    src/presentation/components/TagsInput.tsx
    src/presentation/components/index.ts
  </files>
  <action>
    1. Install @dnd-kit dependencies:
       ```bash
       npm install @dnd-kit/core @dnd-kit/sortable
       ```

    2. Create src/presentation/components/TagsInput.tsx:
       - Accept props: { value: string[], onChange: (tags: string[]) => void, placeholder?: string }
       - Render input field with Enter/comma to add tags, Backspace to remove last
       - Display tags as pills with X to remove
       - Use Tailwind for styling matching existing components

    3. Create src/presentation/components/SortableAlbumCard.tsx:
       - Accept props: { album: AlbumWithCount, onEdit: () => void, onDelete: () => void }
       - Use useSortable from @dnd-kit/sortable with album.id
       - Render drag handle (grip icon using unicode or simple ⋮⋮), album title, description preview, photo count, tags
       - Include Edit and Delete buttons
       - Apply CSS.Transform for drag animation
       - Use existing Tailwind patterns (border, rounded-lg, p-4, hover states)

    4. Create src/presentation/components/AlbumCreateModal.tsx:
       - Accept props: { isOpen: boolean, onClose: () => void, onCreated: () => void, editAlbum?: Album }
       - Modal overlay with form: title (required), description (optional), tags (TagsInput)
       - If editAlbum provided, populate fields and PATCH on submit; otherwise POST to create
       - Handle loading state, error display
       - Call onCreated() on success, which will trigger page refresh

    5. Create src/presentation/components/DeleteAlbumModal.tsx:
       - Accept props: { album: Album, photoCount: number, isOpen: boolean, onClose: () => void, onDeleted: () => void }
       - Radio buttons for delete mode: "Album only" vs "Album and all photos"
       - Warning text explaining what each option does
       - Confirm/Cancel buttons
       - DELETE to /api/admin/albums/[id] with { deletePhotos: boolean }
       - Call onDeleted() on success

    6. Export all new components from src/presentation/components/index.ts

    Define type AlbumWithCount = Album & { photoCount: number } either inline or in a local types file.

  </action>
  <verify>
    Run `npm run lint && npm run build` - no errors
    Check @dnd-kit packages in package.json
    All four component files exist with proper exports
  </verify>
  <done>
    dnd-kit installed, reusable components (TagsInput, SortableAlbumCard, AlbumCreateModal, DeleteAlbumModal) created and exported
  </done>
</task>

<task type="auto">
  <name>Task 2: Create albums page with sortable list</name>
  <files>
    src/app/admin/(protected)/albums/page.tsx
    src/app/admin/(protected)/albums/AlbumsPageClient.tsx
  </files>
  <action>
    1. Create src/app/admin/(protected)/albums/page.tsx (Server Component):
       - Fetch all albums with SQLiteAlbumRepository.findAll()
       - Fetch photo counts with SQLiteAlbumRepository.getPhotoCounts()
       - Merge into albumsWithCounts array
       - Sort by sortOrder ascending
       - Render header with "Albums" title and "Create Album" button
       - Pass albumsWithCounts to AlbumsPageClient

    2. Create src/app/admin/(protected)/albums/AlbumsPageClient.tsx (Client Component):
       - Accept props: { albums: AlbumWithCount[] }
       - State: albums array (local), isCreateModalOpen, editAlbum, deleteAlbum, isSaving
       - DndContext with PointerSensor and KeyboardSensor
       - SortableContext with verticalListSortingStrategy
       - Map albums to SortableAlbumCard components
       - On dragEnd:
         - arrayMove to reorder local state (optimistic)
         - POST to /api/admin/albums/reorder with new albumIds order
         - Revert on error
         - Show "Saving..." indicator during request
       - "Create Album" button opens AlbumCreateModal
       - Edit button on card opens AlbumCreateModal with editAlbum prop
       - Delete button on card opens DeleteAlbumModal
       - On modal success, router.refresh() to reload page data
       - Handle empty state: "No albums yet. Create your first album."

    3. Add link to albums page from admin dashboard (update src/app/admin/(protected)/page.tsx):
       - Add "Manage Albums" link next to "Upload Photos" button

    Use existing patterns from AdminDashboardClient.tsx for structure and Tailwind classes.

  </action>
  <verify>
    Run `npm run lint && npm run build` - no errors
    Navigate to /admin/albums (requires login) - page renders
    Create album, edit album, delete album operations work
    Drag-drop reordering persists after page refresh
  </verify>
  <done>
    Albums management page complete at /admin/albums with full CRUD and drag-drop reordering
  </done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npm run build` succeeds
3. @dnd-kit/core and @dnd-kit/sortable in package.json
4. /admin/albums page accessible and renders album list
5. Create/Edit/Delete modals function correctly
6. Drag-drop reorder persists to database
7. Dashboard has link to albums page
</verification>

<success_criteria>

- Admin can navigate to /admin/albums from dashboard
- Admin can create new albums with title, description, tags
- Admin can edit existing album title, description, tags
- Admin can delete albums with mode selection
- Admin can drag-drop to reorder albums
- Reorder persists to database and survives page refresh
- Photo count displayed per album
- Empty state handled gracefully
  </success_criteria>

<output>
After completion, create `.planning/phases/06-album-management/06-02-SUMMARY.md`
</output>

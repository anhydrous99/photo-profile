---
phase: 09-homepage
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/domain/repositories/PhotoRepository.ts
  - src/infrastructure/database/repositories/SQLitePhotoRepository.ts
  - src/presentation/components/Header.tsx
  - src/presentation/components/HomepageClient.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Homepage displays random photos from published albums"
    - "Photo selection changes on page refresh"
    - "Clicking any photo opens lightbox"
    - "Lightbox navigation stays within homepage photos only"
    - "Header shows logo/initials and Albums link"
    - "Design is minimalist with white background and no photo styling"
  artifacts:
    - path: "src/domain/repositories/PhotoRepository.ts"
      provides: "findRandomFromPublishedAlbums interface method"
      contains: "findRandomFromPublishedAlbums"
    - path: "src/infrastructure/database/repositories/SQLitePhotoRepository.ts"
      provides: "Random photo query with SQL RANDOM()"
      contains: "RANDOM()"
    - path: "src/presentation/components/Header.tsx"
      provides: "Minimal navigation header"
      exports: ["Header"]
    - path: "src/presentation/components/HomepageClient.tsx"
      provides: "Hero + grid layout with lightbox state"
      exports: ["HomepageClient"]
    - path: "src/app/page.tsx"
      provides: "Homepage Server Component"
      contains: "findRandomFromPublishedAlbums"
  key_links:
    - from: "src/app/page.tsx"
      to: "SQLitePhotoRepository.findRandomFromPublishedAlbums"
      via: "repository method call"
      pattern: "findRandomFromPublishedAlbums\\(8\\)"
    - from: "src/presentation/components/HomepageClient.tsx"
      to: "PhotoLightbox"
      via: "dynamic import"
      pattern: "dynamic.*PhotoLightbox"
    - from: "src/app/page.tsx"
      to: "HomepageClient"
      via: "component render with photos prop"
      pattern: "HomepageClient.*photos"
---

<objective>
Implement the homepage displaying random photos from published albums with hero + grid layout.

Purpose: Create the landing page experience where visitors see a curated random selection of photos that changes on each refresh, with one large hero photo and a grid of smaller photos below.

Output: Working homepage at `/` showing 8 random photos (1 hero + 7 grid) from published albums, with lightbox viewing and navigation to albums.
</objective>

<execution_context>
@/Users/arxherre/.claude/get-shit-done/workflows/execute-plan.md
@/Users/arxherre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-homepage/09-CONTEXT.md
@.planning/phases/09-homepage/09-RESEARCH.md

# Existing components and patterns to reuse

@src/presentation/components/PhotoLightbox.tsx
@src/presentation/components/AlbumGalleryClient.tsx
@src/infrastructure/database/repositories/SQLitePhotoRepository.ts
@src/domain/repositories/PhotoRepository.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add random photo repository method</name>
  <files>
    src/domain/repositories/PhotoRepository.ts
    src/infrastructure/database/repositories/SQLitePhotoRepository.ts
  </files>
  <action>
Add `findRandomFromPublishedAlbums(limit: number): Promise<Photo[]>` method:

1. In `src/domain/repositories/PhotoRepository.ts`, add interface method:

   ```typescript
   findRandomFromPublishedAlbums(limit: number): Promise<Photo[]>;
   ```

2. In `src/infrastructure/database/repositories/SQLitePhotoRepository.ts`:
   - Import `sql` from "drizzle-orm" (add to existing imports)
   - Import `albums` from "../schema" (add to existing imports)
   - Implement the method:
     - INNER JOIN photos -> photoAlbums -> albums
     - WHERE photos.status = "ready" AND albums.isPublished = true
     - GROUP BY photos.id (dedupe photos in multiple albums)
     - ORDER BY sql\`RANDOM()\`
     - LIMIT to the requested count
     - Map results through toDomain()

Pattern from research:

```typescript
async findRandomFromPublishedAlbums(limit: number): Promise<Photo[]> {
  const results = await db
    .select({ photo: photos })
    .from(photos)
    .innerJoin(photoAlbums, eq(photos.id, photoAlbums.photoId))
    .innerJoin(albums, eq(photoAlbums.albumId, albums.id))
    .where(
      and(
        eq(photos.status, "ready"),
        eq(albums.isPublished, true)
      )
    )
    .groupBy(photos.id)
    .orderBy(sql`RANDOM()`)
    .limit(limit);

  return results.map((r) => this.toDomain(r.photo));
}
```

  </action>
  <verify>
Run `npm run build` to verify TypeScript compilation succeeds with no errors.
  </verify>
  <done>
PhotoRepository interface has findRandomFromPublishedAlbums method, SQLitePhotoRepository implements it with SQL RANDOM() ordering.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Header and HomepageClient components</name>
  <files>
    src/presentation/components/Header.tsx
    src/presentation/components/HomepageClient.tsx
  </files>
  <action>
Create two new components following established patterns:

**Header.tsx** - Minimal navigation:

- Use `import Link from "next/link"`
- Simple flex layout with justify-between
- Left side: Logo/initials linking to "/" (text "Portfolio" or simple initials like "AP")
- Right side: "Albums" link to "/albums"
- Styling: px-6 py-4, text colors gray-900 for logo, gray-600 for nav link
- No borders, shadows, or complex styling per phase decision

**HomepageClient.tsx** - Hero + grid with lightbox:

- Mark as "use client"
- Dynamic import PhotoLightbox with ssr: false (same pattern as AlbumGalleryClient)
- Props interface: `{ photos: PhotoData[] }` where PhotoData matches PhotoLightbox interface
- State: lightboxOpen (boolean), lightboxIndex (number)
- Split photos: first photo = hero, rest = grid
- Hero section:
  - Button wrapping Image for click handling
  - Aspect ratio 3:2 (aspect-[3/2])
  - Use 1200w.webp size
  - Add `priority` prop for LCP
  - Clean styling: no borders, shadows, rounded corners
  - Only focus ring for accessibility
- Grid section:
  - 2 columns on mobile, 3 columns on md+ (grid-cols-2 md:grid-cols-3)
  - Gap of 4 (gap-4), larger on lg (lg:gap-6)
  - Each photo as button with aspect-square
  - Use 600w.webp size
  - Same clean styling
- Spacious whitespace: mb-8 between hero and grid
- Lightbox renders conditionally when lightboxOpen is true
- Pass full photos array to lightbox (navigation stays within homepage photos)

Pattern: Follow AlbumGalleryClient.tsx structure but adapt for hero+grid layout.
</action>
<verify>
Run `npm run build` to verify TypeScript compilation succeeds with no errors.
</verify>
<done>
Header.tsx exports Header component with logo and Albums link. HomepageClient.tsx exports HomepageClient with hero+grid layout and lightbox integration.
</done>
</task>

<task type="auto">
  <name>Task 3: Replace homepage with photo gallery</name>
  <files>
    src/app/page.tsx
  </files>
  <action>
Replace the default Next.js homepage with the photo gallery:

1. Remove all existing content (Next.js boilerplate)
2. Make it a Server Component (default, no "use client")
3. Add `export const dynamic = "force-dynamic"` to ensure fresh random on each request
4. Import:
   - SQLitePhotoRepository from infrastructure
   - HomepageClient and Header from presentation/components

5. In the default export async function:
   - Instantiate SQLitePhotoRepository
   - Call findRandomFromPublishedAlbums(8) to get 8 random photos
   - Return JSX structure:
     ```jsx
     <>
       <Header />
       <main className="mx-auto max-w-6xl px-4 py-8">
         {photos.length === 0 ? (
           <div className="flex min-h-[60vh] items-center justify-center">
             <p className="text-gray-500">No photos available yet.</p>
           </div>
         ) : (
           <HomepageClient
             photos={photos.map((p) => ({
               id: p.id,
               title: p.title,
               description: p.description,
               originalFilename: p.originalFilename,
             }))}
           />
         )}
       </main>
     </>
     ```

6. Background: White (default body background, or add bg-white if needed)
   </action>
   <verify>
7. Run `npm run build` to verify build succeeds
8. Run `npm run dev` and visit http://localhost:3000
9. Verify:
   - Header shows with logo/initials and Albums link
   - Photos display (hero + grid) OR "No photos available yet" message
   - If photos exist: refresh page multiple times to see different random selection
     </verify>
     <done>
     Homepage displays random photos from published albums with hero+grid layout, or empty state message. Header provides navigation to Albums. Design is minimalist with white background.
     </done>
     </task>

</tasks>

<verification>
After all tasks complete:
1. Build passes: `npm run build` succeeds without errors
2. Homepage loads: http://localhost:3000 shows Header + photo content or empty state
3. Random selection: Multiple refreshes show different photo arrangements
4. Lightbox works: Clicking any photo opens lightbox overlay
5. Lightbox navigation: Arrow keys/buttons navigate within homepage photos only
6. Albums link: Clicking "Albums" in header navigates to /albums
7. Responsive: Grid is 2-col on mobile, 3-col on desktop
8. Clean design: No borders, shadows, or hover effects on photos
</verification>

<success_criteria>

- Homepage displays 8 random photos from published albums (1 hero + 7 grid)
- Photo selection changes on each page refresh
- Clicking any photo opens lightbox with navigation scoped to homepage photos
- Header shows logo/initials and Albums link
- Design is minimalist: white background, no photo borders/shadows/hover effects
- Responsive layout works on mobile and desktop
- Empty state shows when no published photos exist
  </success_criteria>

<output>
After completion, create `.planning/phases/09-homepage/09-01-SUMMARY.md`
</output>

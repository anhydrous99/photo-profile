---
phase: 08-lightbox
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/presentation/components/PhotoLightbox.tsx
  - src/presentation/components/AlbumGalleryClient.tsx
  - src/app/albums/[id]/page.tsx
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - "Clicking a photo opens it in a lightbox overlay"
    - "Left/right arrows navigate between photos"
    - "Escape key closes the lightbox"
    - "Photo description displayed when viewing"
    - "Swipe gestures work on mobile"
  artifacts:
    - path: "src/presentation/components/PhotoLightbox.tsx"
      provides: "YARL lightbox wrapper with Captions plugin"
      exports: ["PhotoLightbox"]
    - path: "src/presentation/components/AlbumGalleryClient.tsx"
      provides: "Client component managing lightbox open/close state"
      exports: ["AlbumGalleryClient"]
    - path: "src/app/albums/[id]/page.tsx"
      provides: "Server component fetching data, delegating to client"
      contains: "AlbumGalleryClient"
  key_links:
    - from: "src/presentation/components/AlbumGalleryClient.tsx"
      to: "PhotoLightbox"
      via: "dynamic import with ssr: false"
      pattern: "dynamic.*PhotoLightbox.*ssr.*false"
    - from: "src/presentation/components/PhotoLightbox.tsx"
      to: "/api/images/[id]/2400w.webp"
      via: "slide src for full-size images"
      pattern: "api/images.*2400w"
    - from: "src/app/albums/[id]/page.tsx"
      to: "AlbumGalleryClient"
      via: "renders client component with serialized data"
      pattern: "AlbumGalleryClient.*photos"
---

<objective>
Implement lightbox functionality for the public gallery using yet-another-react-lightbox (YARL).

Purpose: Enable visitors to view photos in an immersive full-size overlay with keyboard and touch navigation. This is the core photo viewing experience where visitors engage with the photography work.

Output:

- PhotoLightbox component wrapping YARL with project-specific configuration
- AlbumGalleryClient managing lightbox state with dynamic import
- Updated album detail page with server/client component split
  </objective>

<execution_context>
@/Users/arxherre/.claude/get-shit-done/workflows/execute-plan.md
@/Users/arxherre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-lightbox/08-CONTEXT.md
@.planning/phases/08-lightbox/08-RESEARCH.md
@src/app/albums/[id]/page.tsx
@src/presentation/components/Breadcrumb.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install YARL and create PhotoLightbox component</name>
  <files>
    - package.json
    - package-lock.json
    - src/presentation/components/PhotoLightbox.tsx
  </files>
  <action>
1. Install yet-another-react-lightbox:
   ```bash
   npm install yet-another-react-lightbox
   ```

2. Create `src/presentation/components/PhotoLightbox.tsx`:
   - Add "use client" directive (YARL requires client-side React)
   - Import Lightbox from "yet-another-react-lightbox"
   - Import Captions plugin from "yet-another-react-lightbox/plugins/captions"
   - Import BOTH CSS files (critical - see RESEARCH.md Pitfall 1):
     - "yet-another-react-lightbox/styles.css"
     - "yet-another-react-lightbox/plugins/captions.css"

   - Define PhotoData interface: { id, title, description, originalFilename }
   - Define PhotoLightboxProps: { photos, index, onClose, onIndexChange? }

   - Transform photos to YARL slides format:
     - src: `/api/images/${photo.id}/2400w.webp` (use largest size for full-view)
     - alt: photo.title || photo.originalFilename
     - title: photo.title || undefined (not null - see Pitfall 2)
     - description: photo.description || undefined

   - Configure Lightbox per CONTEXT.md decisions:
     - open={true}, close={onClose}, index={index}
     - plugins={[Captions]}
     - styles={{ container: { backgroundColor: "rgb(0, 0, 0)" } }} (solid black)
     - carousel: { padding: "5%", spacing: "10%", imageFit: "contain", preload: 2 }
     - animation: { fade: 200, swipe: 300 }
     - controller: { closeOnBackdropClick: false, closeOnPullDown: false, closeOnPullUp: false } (X button only)
     - captions: { descriptionTextAlign: "center", descriptionMaxLines: 5 }
     - on: { view: ({ index }) => onIndexChange?.(index) }

3. Export named `PhotoLightbox` function component.
   </action>
   <verify> - `npm run typecheck` passes - `npm run lint` passes - File exists at src/presentation/components/PhotoLightbox.tsx - Both CSS imports present (grep for "yet-another-react-lightbox/styles.css" and "captions.css")
   </verify>
   <done>
   PhotoLightbox component created with YARL configured per phase decisions: solid black background, contain fit, 5% padding, X-button-only close, Captions plugin enabled.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Create AlbumGalleryClient and update album page</name>
  <files>
    - src/presentation/components/AlbumGalleryClient.tsx
    - src/app/albums/[id]/page.tsx
  </files>
  <action>
1. Create `src/presentation/components/AlbumGalleryClient.tsx`:
   - Add "use client" directive
   - Import dynamic from "next/dynamic"
   - Import Image from "next/image"
   - Import useState from "react"
   - Import Breadcrumb from "@/presentation/components/Breadcrumb"

- Dynamic import PhotoLightbox with ssr: false (critical - see Pitfall 4):

  ```typescript
  const PhotoLightbox = dynamic(
    () => import("./PhotoLightbox").then((mod) => mod.PhotoLightbox),
    { ssr: false },
  );
  ```

- Define PhotoData interface (same as PhotoLightbox)
- Define AlbumGalleryClientProps: { album: { id, title, description }, photos: PhotoData[] }

- Implement component with useState for lightbox:
  - const [lightboxOpen, setLightboxOpen] = useState(false)
  - const [lightboxIndex, setLightboxIndex] = useState(0)

- handlePhotoClick(index): setLightboxIndex(index), setLightboxOpen(true)
- handleLightboxClose(): setLightboxOpen(false)

- Render structure (reuse existing album page layout):
  - Breadcrumb with Home / Albums / {album.title}
  - h1 with album.title
  - Description paragraph if album.description exists
  - Empty state message if photos.length === 0
  - Photo grid with onClick handlers on each photo:
    - Use button element (not div) for accessibility
    - aria-label="View {photo.title || photo.originalFilename}"
    - focus ring styles for keyboard navigation
  - Conditional lightbox render when lightboxOpen is true

- Export named `AlbumGalleryClient`

2. Update `src/app/albums/[id]/page.tsx`:
   - Keep as Server Component (no "use client")
   - Keep existing imports for repositories and notFound
   - Import AlbumGalleryClient from "@/presentation/components/AlbumGalleryClient"
   - Remove Image and Breadcrumb imports (moved to client component)

   - Keep existing data fetching logic (album, photos, filtering)

   - Simplify return: render AlbumGalleryClient with props:
     - album: { id: album.id, title: album.title, description: album.description }
     - photos: photos.map(p => ({ id, title, description, originalFilename }))

   - Ensure only serializable data passed to client (no Date objects, no functions)
     </action>
     <verify>
   - `npm run typecheck` passes
   - `npm run lint` passes
   - `npm run build` succeeds (no hydration errors)
   - Album page loads at localhost:3000/albums/{id}
   - Clicking photo opens lightbox
   - Arrow keys navigate between photos
   - Escape closes lightbox
   - Swipe works on mobile viewport (Chrome DevTools device mode)
     </verify>
     <done>
     AlbumGalleryClient component handles lightbox state with dynamic import. Album detail page refactored to server/client split. Full lightbox functionality working: click to open, keyboard navigation (arrows/escape), swipe gestures, photo descriptions displayed.
     </done>
     </task>

</tasks>

<verification>
After completing both tasks:

1. Manual verification flow:
   - Start dev server: `npm run dev`
   - Navigate to /albums and click an album
   - Click any photo - lightbox should open with solid black background
   - Photo should fit within viewport with padding (not touch edges)
   - Arrow keys should navigate between photos
   - Escape should close lightbox
   - If photo has description, it should display centered below photo
   - X button in top-right should close lightbox
   - On mobile viewport: swipe left/right to navigate

2. Build verification:
   - `npm run build` completes without errors
   - No hydration mismatch warnings in console

3. Code quality:
   - `npm run lint` passes
   - `npm run typecheck` passes
     </verification>

<success_criteria>

- [ ] YARL installed (package.json has yet-another-react-lightbox)
- [ ] PhotoLightbox.tsx exists with solid black background config
- [ ] AlbumGalleryClient.tsx exists with dynamic import and ssr: false
- [ ] Album page refactored to server/client component split
- [ ] Clicking photo opens lightbox with full-size image (2400w)
- [ ] Keyboard navigation works (arrows, escape)
- [ ] Photo descriptions display in lightbox
- [ ] Build succeeds without hydration errors
      </success_criteria>

<output>
After completion, create `.planning/phases/08-lightbox/08-01-SUMMARY.md`
</output>

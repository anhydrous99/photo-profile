---
phase: 05-photo-management
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - src/app/admin/(protected)/photos/[id]/page.tsx
  - src/presentation/components/PhotoDetail.tsx
  - src/presentation/components/AlbumSelector.tsx
  - src/presentation/components/index.ts
autonomous: true

must_haves:
  truths:
    - "Admin can view a photo's details on dedicated page"
    - "Admin can edit description with auto-save on blur"
    - "Admin can assign photo to albums from detail page"
    - "Admin can delete photo with confirmation"
  artifacts:
    - path: "src/app/admin/(protected)/photos/[id]/page.tsx"
      provides: "Photo detail page route"
      min_lines: 20
    - path: "src/presentation/components/PhotoDetail.tsx"
      provides: "Photo detail display and editing"
      contains: "handleDescriptionBlur"
    - path: "src/presentation/components/AlbumSelector.tsx"
      provides: "Album checkbox selection component"
      contains: "onChange"
  key_links:
    - from: "src/presentation/components/PhotoDetail.tsx"
      to: "/api/admin/photos/[id]"
      via: "PATCH on blur for description"
      pattern: "fetch.*PATCH"
    - from: "src/presentation/components/AlbumSelector.tsx"
      to: "/api/admin/photos/[id]/albums"
      via: "POST/DELETE for album changes"
      pattern: "fetch.*/albums"
---

<objective>
Create photo detail page with description editing (auto-save) and album assignment.

Purpose: Primary interface for managing individual photo metadata and organization.
Output: Photo detail page at /admin/photos/[id] with editable description and album checkboxes.
</objective>

<execution_context>
@/Users/arxherre/.claude/get-shit-done/workflows/execute-plan.md
@/Users/arxherre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-photo-management/05-CONTEXT.md

@src/app/admin/(protected)/page.tsx
@src/presentation/components/PhotoGrid.tsx
@src/domain/entities/Photo.ts
@src/domain/entities/Album.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PhotoDetail component with auto-save</name>
  <files>
    src/presentation/components/PhotoDetail.tsx
    src/presentation/components/index.ts
  </files>
  <action>
Create client component `PhotoDetail.tsx` ("use client"):

**Props:**

```typescript
interface PhotoDetailProps {
  photo: Photo;
  albums: Album[];
  photoAlbumIds: string[];
}
```

**Display:**

- Photo filename and status badge (reuse StatusBadge pattern from PhotoGrid)
- Placeholder for thumbnail (gray box, same as PhotoGrid)
- Created/updated dates
- Description textarea (editable)

**Description editing with auto-save:**

1. Local state for description (initialize from photo.description)
2. Local state for saving indicator
3. On textarea blur: if value changed, PATCH to `/api/admin/photos/${photo.id}`
4. Show "Saving..." indicator during request
5. Show "Saved" briefly after success
6. Handle errors gracefully (show error message)

**Delete button:**

- Red "Delete Photo" button
- On click: show browser confirm() dialog
- If confirmed: DELETE to `/api/admin/photos/${photo.id}`
- On success: redirect to /admin using router.push()

Export from index.ts.
</action>
<verify>
`npx tsc --noEmit` - TypeScript compiles
</verify>
<done>
PhotoDetail component renders photo info with editable description that auto-saves on blur.
Delete button shows confirmation and redirects on success.
</done>
</task>

<task type="auto">
  <name>Task 2: Create AlbumSelector component</name>
  <files>
    src/presentation/components/AlbumSelector.tsx
    src/presentation/components/index.ts
  </files>
  <action>
Create client component `AlbumSelector.tsx` ("use client"):

**Props:**

```typescript
interface AlbumSelectorProps {
  photoId: string;
  albums: Album[];
  selectedAlbumIds: string[];
}
```

**Display:**

- Section heading "Albums"
- Checkbox list of all albums
- Each checkbox shows album title
- Checked state based on selectedAlbumIds

**Album toggle logic:**

1. Local state for selectedIds (initialize from props)
2. On checkbox change:
   - If checking: POST to `/api/admin/photos/${photoId}/albums` with `{ albumId }`
   - If unchecking: DELETE to `/api/admin/photos/${photoId}/albums` with `{ albumId }`
3. Optimistically update local state
4. On error: revert state and show error

**Empty state:**

- If no albums exist, show "No albums yet. Create albums in Album Management."

Export from index.ts.
</action>
<verify>
`npx tsc --noEmit` - TypeScript compiles
</verify>
<done>
AlbumSelector shows checkbox list of albums, toggling immediately calls API and updates state.
</done>
</task>

<task type="auto">
  <name>Task 3: Create photo detail page</name>
  <files>src/app/admin/(protected)/photos/[id]/page.tsx</files>
  <action>
Create server component page at `src/app/admin/(protected)/photos/[id]/page.tsx`:

**Data fetching (server):**

1. Get photoId from params
2. Fetch photo by ID using SQLitePhotoRepository
3. If photo not found, call notFound() (Next.js 404)
4. Fetch all albums using SQLiteAlbumRepository
5. Fetch photo's album IDs using photoRepository.getAlbumIds()

**Render:**

- Back link to /admin (arrow + "Back to Dashboard")
- PhotoDetail component with photo, albums, photoAlbumIds
- AlbumSelector component with photoId, albums, selectedAlbumIds

**Layout:**

- Simple single-column layout
- Photo detail on left/top
- Album selector below or on right
- Use existing Tailwind patterns (p-8, rounded-lg, etc.)
  </action>
  <verify>

1. `npm run lint` passes
2. `npm run build` completes
3. Dev server: Navigate to /admin/photos/{some-id}
   - Should show photo details
   - Should show album checkboxes (even if empty)
   - Editing description and blurring should save
     </verify>
     <done>
     Photo detail page loads photo, albums, and membership data.
     PhotoDetail and AlbumSelector components render and function.
     Non-existent photo shows 404.
     </done>
     </task>

</tasks>

<verification>
- [ ] `npm run lint` passes
- [ ] `npm run build` completes
- [ ] Photo detail page loads at /admin/photos/[id]
- [ ] Description auto-saves on blur (verify with network tab)
- [ ] Album checkboxes call API on change
- [ ] Delete button shows confirmation and redirects
- [ ] Non-existent photo ID returns 404 page
</verification>

<success_criteria>

1. /admin/photos/[id] displays photo details with description textarea
2. Editing description and clicking away triggers PATCH request
3. "Saving..." indicator shows during save, "Saved" after
4. Album checkboxes toggle photo-album membership
5. Delete button shows confirmation dialog
6. Confirmed delete removes photo and redirects to dashboard
7. Invalid photo ID shows Next.js 404 page
   </success_criteria>

<output>
After completion, create `.planning/phases/05-photo-management/05-03-SUMMARY.md`
</output>

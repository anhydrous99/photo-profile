---
phase: 05-photo-management
plan: 04
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - src/presentation/components/PhotoGrid.tsx
  - src/presentation/components/BatchActions.tsx
  - src/presentation/components/index.ts
  - src/app/admin/(protected)/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can select multiple photos in grid"
    - "Admin can assign selected photos to albums in batch"
    - "Admin can delete selected photos in batch"
    - "Selection state clears after batch operation"
  artifacts:
    - path: "src/presentation/components/PhotoGrid.tsx"
      provides: "Grid with selectable photos"
      contains: "onSelectionChange"
    - path: "src/presentation/components/BatchActions.tsx"
      provides: "Batch operation controls"
      contains: "handleBatchDelete"
    - path: "src/app/admin/(protected)/page.tsx"
      provides: "Dashboard with selection state"
      contains: "selectedIds"
  key_links:
    - from: "src/presentation/components/BatchActions.tsx"
      to: "/api/admin/photos/[id]"
      via: "DELETE for each selected photo"
      pattern: "Promise\\.all.*DELETE"
    - from: "src/presentation/components/BatchActions.tsx"
      to: "/api/admin/photos/[id]/albums"
      via: "POST for each selected photo"
      pattern: "Promise\\.all.*albums"
---

<objective>
Add multi-select to photo grid with batch album assignment and batch delete.

Purpose: Enable efficient management of multiple photos at once - critical for large photo libraries.
Output: Selectable PhotoGrid with BatchActions toolbar for album assignment and deletion.
</objective>

<execution_context>
@/Users/arxherre/.claude/get-shit-done/workflows/execute-plan.md
@/Users/arxherre/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-photo-management/05-CONTEXT.md

@src/presentation/components/PhotoGrid.tsx
@src/app/admin/(protected)/page.tsx
@src/domain/entities/Album.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add selection to PhotoGrid</name>
  <files>src/presentation/components/PhotoGrid.tsx</files>
  <action>
Convert PhotoGrid to support selection mode:

**New props (optional for backwards compatibility):**

```typescript
interface PhotoGridProps {
  photos: Photo[];
  selectable?: boolean;
  selectedIds?: Set<string>;
  onSelectionChange?: (selectedIds: Set<string>) => void;
  onPhotoClick?: (photoId: string) => void;
}
```

**Selection behavior (when selectable=true):**

1. Show checkbox overlay on each PhotoCard (top-left corner, visible on hover OR when selected)
2. Clicking checkbox toggles selection (doesn't navigate)
3. Clicking photo card body navigates to detail page (existing behavior via onPhotoClick)

**PhotoCard changes:**

- Add `isSelected` and `onSelect` props
- Checkbox input (styled, semi-transparent background)
- Checkbox visible on hover OR when checked
- Checkbox click event stops propagation (prevent card click)

**Keep backwards compatible:**

- If selectable not provided, behave exactly as before (no checkboxes)
- Existing PhotoGrid usage in dashboard won't break
  </action>
  <verify>
  `npx tsc --noEmit` - TypeScript compiles
  </verify>
  <done>
  PhotoGrid shows selection checkboxes when selectable=true.
  Checkboxes toggle selection without navigating.
  Card body click still navigates to detail page.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create BatchActions component</name>
  <files>
    src/presentation/components/BatchActions.tsx
    src/presentation/components/index.ts
  </files>
  <action>
Create client component `BatchActions.tsx` ("use client"):

**Props:**

```typescript
interface BatchActionsProps {
  selectedIds: Set<string>;
  albums: Album[];
  onComplete: () => void; // Called after operation to clear selection
}
```

**Display (only show when selectedIds.size > 0):**

- Selection count: "{N} photos selected"
- Album assignment dropdown:
  - Select element with albums as options
  - "Add to Album" button
- Delete button (red, with warning icon)

**Batch album assignment:**

1. When album selected and "Add to Album" clicked:
2. For each photoId in selectedIds:
   - POST to `/api/admin/photos/${photoId}/albums` with `{ albumId }`
3. Use Promise.all for parallel requests
4. On success: call onComplete(), show success message
5. On error: show error count

**Batch delete:**

1. Show confirm() with count: "Delete {N} photos? This cannot be undone."
2. If confirmed, for each photoId:
   - DELETE to `/api/admin/photos/${photoId}`
3. Use Promise.all for parallel requests
4. On success: call onComplete()
5. On error: show error count

**Loading states:**

- Show spinner/disabled state during operations
- Prevent double-clicks

Export from index.ts.
</action>
<verify>
`npx tsc --noEmit` - TypeScript compiles
</verify>
<done>
BatchActions shows when photos selected.
Album dropdown enables batch assignment.
Delete button confirms and removes selected photos.
onComplete called after operations.
</done>
</task>

<task type="auto">
  <name>Task 3: Integrate selection into admin dashboard</name>
  <files>src/app/admin/(protected)/page.tsx</files>
  <action>
Update admin dashboard to enable selection and batch operations:

**Convert to client wrapper pattern:**
Since selection state requires "use client", create a client wrapper:

Option A (preferred): Keep page as server component, pass data to client component

- Page fetches photos and albums (server)
- Renders `<AdminDashboardClient photos={photos} albums={albums} />`

**New client component in same file or separate:**

```typescript
"use client";
function AdminDashboardClient({
  photos,
  albums,
}: {
  photos: Photo[];
  albums: Album[];
}) {
  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
  // ... render PhotoGrid with selection, BatchActions
}
```

**Data fetching additions:**

- Fetch albums using SQLiteAlbumRepository (needed for BatchActions)

**Render changes:**

1. BatchActions above PhotoGrid (shows when selection active)
2. PhotoGrid with selectable=true, selectedIds, onSelectionChange
3. PhotoCard click navigates to /admin/photos/[id] (add Link or router.push)

**Selection clear:**

- onComplete from BatchActions clears selectedIds
- Page should refresh photos list (router.refresh() or revalidate)
  </action>
  <verify>

1. `npm run lint` passes
2. `npm run build` completes
3. Dev server: /admin dashboard
   - Hover over photo shows checkbox
   - Clicking checkbox selects photo (checkbox stays visible)
   - BatchActions bar appears when photos selected
   - Clicking photo card body navigates to detail page
     </verify>
     <done>
     Dashboard shows selectable photo grid.
     BatchActions bar appears with selection count, album dropdown, delete button.
     Operations work and clear selection afterward.
     Photo card click navigates to detail page.
     </done>
     </task>

</tasks>

<verification>
- [ ] `npm run lint` passes
- [ ] `npm run build` completes
- [ ] Photo checkboxes visible on hover in grid
- [ ] Selecting photos shows BatchActions bar
- [ ] Batch album assignment adds all selected photos to album
- [ ] Batch delete removes all selected photos (with confirmation)
- [ ] Selection clears after batch operation
- [ ] Page refreshes to show updated photo list
- [ ] Photo card click still navigates to detail page
</verification>

<success_criteria>

1. Hovering over photo card reveals selection checkbox
2. Clicking checkbox toggles selection (doesn't navigate)
3. BatchActions bar shows selected count, album dropdown, delete button
4. "Add to Album" assigns all selected photos to chosen album
5. Delete button confirms and removes all selected photos
6. Selection clears after any batch operation
7. Photo list updates to reflect deletions
8. Clicking photo card body navigates to /admin/photos/[id]
   </success_criteria>

<output>
After completion, create `.planning/phases/05-photo-management/05-04-SUMMARY.md`
</output>

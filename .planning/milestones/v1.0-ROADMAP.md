# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-05
**Phases:** 1-10
**Total Plans:** 29

## Overview

This roadmap delivers a personal photography portfolio website where visitors browse random photos on the homepage, explore albums, and view photos in a lightbox. The admin manages content through a password-protected panel with drag-drop uploads. The build order prioritizes infrastructure (database, image processing) before user-facing features, ensuring each phase produces verifiable, working functionality.

## Phases

### Phase 1: Foundation

**Goal**: Establish the core infrastructure for storing photos and albums
**Depends on**: Nothing (first phase)
**Plans**: 3 plans

Plans:

- [x] 01-01-PLAN.md — Project scaffolding and clean architecture setup
- [x] 01-02-PLAN.md — Domain entities, repository interfaces, and Drizzle schema
- [x] 01-03-PLAN.md — Repository implementations and development tooling

**Details:**
Next.js 16 project scaffolded with clean architecture folder structure (domain/application/infrastructure/presentation). SQLite database created with Photo and Album tables via Drizzle ORM. File storage directory structure established for originals and derivatives. Repository pattern implemented for Photo and Album entities.

### Phase 2: Image Pipeline

**Goal**: Enable automatic thumbnail and optimized image generation
**Depends on**: Phase 1
**Plans**: 4 plans

Plans:

- [x] 02-01-PLAN.md — Dependencies and BullMQ queue configuration
- [x] 02-02-PLAN.md — Sharp image processing service
- [x] 02-03-PLAN.md — Worker implementation and startup script
- [x] 02-04-PLAN.md — Gap closure: AVIF format instead of JPEG

**Details:**
BullMQ job queue with Redis for async processing. Sharp generates WebP + AVIF derivatives at 300/600/1200/2400px widths. Worker runs as separate process via `npm run worker`. Exponential backoff retries, concurrency 2 for memory management with 50MP images.

### Phase 3: Admin Auth

**Goal**: Protect admin features with password authentication
**Depends on**: Phase 1
**Plans**: 3 plans

Plans:

- [x] 03-01-PLAN.md — Auth infrastructure (session, password, rate limiting, DAL)
- [x] 03-02-PLAN.md — Login page and Server Action
- [x] 03-03-PLAN.md — Route protection (proxy.ts and protected layout)

**Details:**
JWT-based sessions via jose library. Bcrypt password hashing (cost factor 10). Rate limiting via rate-limiter-flexible + Redis. Two-layer route protection: proxy.ts (Edge, cookie existence) + protected layout (Server Component, full JWT verification). Unauthenticated /admin/\* returns 404.

### Phase 4: Photo Upload

**Goal**: Admin can upload photos through intuitive drag-drop interface
**Depends on**: Phase 2, Phase 3
**Plans**: 3 plans

Plans:

- [x] 04-01-PLAN.md — Upload infrastructure (Route Handler and file storage)
- [x] 04-02-PLAN.md — Client components (DropZone and upload function)
- [x] 04-03-PLAN.md — Upload page with batch state and admin photo list

**Details:**
Drag-drop zone accepts JPEG, PNG, WebP, HEIC. Multiple file batch upload with per-file progress via XHR. Files saved to storage/originals/{photoId}/. Upload triggers BullMQ job for image processing. Admin photo list shows processing status.

### Phase 5: Photo Management

**Goal**: Admin can manage photo metadata and organization
**Depends on**: Phase 4
**Plans**: 4 plans

Plans:

- [x] 05-01-PLAN.md — Photo API and file cleanup (PATCH/DELETE endpoints)
- [x] 05-02-PLAN.md — Album assignment API (photo-album relationships)
- [x] 05-03-PLAN.md — Photo detail page with auto-save and album selector
- [x] 05-04-PLAN.md — Batch selection and operations in grid

**Details:**
Auto-save description on blur. Album assignment via checkbox selector with optimistic updates. Photo deletion removes all files (originals + derivatives) before database record. Batch selection in grid with batch assign/delete operations via Promise.all.

### Phase 6: Album Management

**Goal**: Admin can organize photos into albums with drag-drop ordering and category tags
**Depends on**: Phase 5
**Plans**: 2 plans

Plans:

- [x] 06-01-PLAN.md — Album API infrastructure (CRUD endpoints, photo counts, reorder, cascade delete)
- [x] 06-02-PLAN.md — Album list UI with drag-drop ordering and CRUD modals

**Details:**
Full CRUD for albums with names, descriptions, and tags (comma-separated TEXT). Cover photo auto-selection. Drag-to-reorder via dnd-kit with optimistic UI updates. Delete modes: album-only (photos unassigned) or cascade (delete album + photos). Published toggle controls public visibility.

### Phase 7: Public Gallery

**Goal**: Visitors can browse albums and view photo grids
**Depends on**: Phase 6
**Plans**: 3 plans

Plans:

- [x] 07-01-PLAN.md — Image serving API route
- [x] 07-02-PLAN.md — Album listing page, Breadcrumb, and photo grid
- [x] 07-03-PLAN.md — Visual verification checkpoint

**Details:**
Image API route serves processed derivatives with immutable caching (1 year, public). Album listing page shows published albums with cover thumbnails. Album detail displays responsive 1/2/3 column photo grid. Breadcrumb navigation between pages.

### Phase 8: Lightbox

**Goal**: Visitors can view photos in immersive full-size display
**Depends on**: Phase 7
**Plans**: 2 plans

Plans:

- [x] 08-01-PLAN.md — YARL lightbox integration and album page refactor
- [x] 08-02-PLAN.md — Visual verification checkpoint

**Details:**
YARL (yet-another-react-lightbox) with dynamic import (ssr: false). Solid black background. Arrow key and Escape keyboard navigation. Photo descriptions displayed. X-button-only close (no click-outside). 600w image size for lightbox display.

### Phase 9: Homepage

**Goal**: Visitors see curated random selection on landing page
**Depends on**: Phase 8
**Plans**: 2 plans

Plans:

- [x] 09-01-PLAN.md — Homepage implementation (repository method, header, hero+grid layout)
- [x] 09-02-PLAN.md — Visual verification checkpoint

**Details:**
SQL RANDOM() with GROUP BY for deduplicated random photo selection from published albums. Hero image (1200w) + grid (600w) layout. force-dynamic for fresh random selection on each request. Lightbox scoped to homepage photos.

### Phase 10: Polish

**Goal**: Final optimizations for production-quality experience
**Depends on**: Phase 8, Phase 9
**Plans**: 3 plans

Plans:

- [x] 10-01-PLAN.md — Blur placeholder generation infrastructure (schema, worker pipeline, backfill)
- [x] 10-02-PLAN.md — Frontend display with FadeImage component, custom loader, and performance optimization
- [x] 10-03-PLAN.md — Docker deployment configuration (Dockerfile, docker-compose)

**Details:**
10px WebP LQIP blur placeholders (~130 bytes) generated during processing and stored as base64 in database. FadeImage component with CSS opacity transition (~300ms fade-in). Custom image loader bypasses Next.js optimization for pre-processed Sharp derivatives. Multi-stage Dockerfile with node:22-slim. Docker-compose orchestrates web, worker, and Redis services.

---

## Milestone Summary

**Key Decisions:**

- Clean Architecture with domain/application/infrastructure/presentation layers
- SQLite via better-sqlite3 + Drizzle ORM for simplicity
- BullMQ + Redis for async image processing
- Sharp for WebP + AVIF derivative generation at 4 sizes
- JWT (jose) for admin sessions, bcrypt for password hashing
- YARL for lightbox, dnd-kit for drag-drop reordering
- LQIP blur placeholders with CSS fade-in transitions
- Standalone Next.js output for Docker deployment

**Issues Resolved:**

- Schema migration failures when using db:push — switched to ALTER TABLE directly
- AVIF format gap discovered during audit — added Phase 2 Plan 04 to close it
- Upload progress required XHR instead of fetch (fetch lacks upload.onprogress)

**Issues Deferred:**

- coverPhotoId FK constraint mismatch (schema says SET NULL, DB has NO ACTION) — low severity
- EXIF metadata extraction — deferred to v2 requirements
- Docker build not tested locally (Docker not installed on dev machine)

**Technical Debt Incurred:**

- Stale comment in imageProcessor.ts line 46 (says "WebP + JPEG" but code generates WebP + AVIF)
- coverPhotoId FK constraint NO ACTION instead of SET NULL
- Docker configuration untested

---

_For current project status, see .planning/MILESTONES.md_
